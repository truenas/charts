{{if .Values.newslyBackupCronJob.enabled }}

apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ .Chart.Name }}-cronjob
spec:
  schedule: "{{ .Values.newslyCronjob.schedule }}"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 2
  successfulJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: {{ .Chart.Name }}-backup-cronjob
            image: "{{.Values.dbimage.repository }}:{{.Values.dbimage.tag }}"
            command: ["python", "/newsly/app-scraper.py"]

            command:
              - "/bin/bash"
              - "-c"
              - |
                TIMESTAMP=$(date +\%Y-\%m-\%dT\%H:\%M:\%S)
                pg_dump -h your_db_host -p your_db_port -U your_db_user your_db_name > /tmp/backups/databasename-${TIMESTAMP}.sql

            
          restartPolicy: OnFailure
{{ end }}
