{{- include "ix.v1.common.loader.init" . -}}

{{/* Make sure the dict exists before we add values to it */}}
{{- $keys := list "workload" "secret" "configmap" "service" "persistence" "scaleCertificate" -}}
{{- range $key := $keys -}}
  {{- if not (hasKey $.Values $key) -}}
    {{- $_ := set $.Values $key dict -}}
  {{- end -}}
{{- end -}}

{{/* Add the templates in the appropriate sections */}}
{{- $_ := set .Values "service" (include "minio.services" $ | fromYaml) -}}
{{- $_ := set .Values "persistence" (include "minio.persistence" $ | fromYaml) -}}
{{- if .Values.minio.certificate_id -}}
  {{- $_ := set .Values "scaleCertificate" (include "minio.certificate" $ | fromYaml) -}}
{{- end -}}
{{- $_ := set .Values.secret "minio-creds" (include "minio.creds" $ | fromYaml) -}}
{{- $_ := set .Values.configmap "minio-config" (include "minio.config" $ | fromYaml) -}}
{{- $_ := set .Values.workload "minio" (include "minio.workload" $ | fromYaml) -}}

{{- include "ix.v1.common.loader.apply" . -}}
